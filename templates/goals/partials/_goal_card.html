<div class="goal-card priority-{{ goal.priority }}">
    <div class="goal-card-header">
        <div>
            <a href="{% url 'goals:goal_detail' pk=goal.pk %}" class="goal-title">
                {{ goal.title }}
            </a>
            <div class="mt-1">
                <span class="goal-category">
                    <i class="{{ goal.category_icon }}"></i>
                    {{ goal.get_category_display }}
                </span>
            </div>
        </div>
        <div class="d-flex flex-column gap-1 align-items-end">
            <span class="status-badge {{ goal.status }}">{{ goal.get_status_display }}</span>
            <span class="priority-badge {{ goal.priority }}">{{ goal.get_priority_display }}</span>
        </div>
    </div>

    {% if goal.description %}
    <p class="goal-description">{{ goal.description }}</p>
    {% endif %}

    <div class="goal-progress">
        <div class="progress-bar-container">
            <div class="progress-bar-fill {% if goal.status == 'completed' %}completed{% endif %}"
                 style="width: {{ goal.progress_percentage|floatformat:0 }}%"></div>
        </div>
        <div class="progress-text">
            <span>{{ goal.progress_percentage|floatformat:0 }}% complete</span>
            {% if goal.target_value %}
            <span>{{ goal.current_value|floatformat:0 }} / {{ goal.target_value|floatformat:0 }} {{ goal.unit }}</span>
            {% endif %}
        </div>
    </div>

    <div class="goal-meta">
        {% if goal.due_date %}
        <span class="goal-meta-item {% if goal.is_overdue %}overdue{% endif %}">
            <i class="bi {% if goal.is_overdue %}bi-exclamation-triangle{% else %}bi-calendar{% endif %}"></i>
            {% if goal.is_overdue %}
            Overdue by {{ goal.days_remaining|slice:"1:" }} days
            {% elif goal.days_remaining == 0 %}
            Due today
            {% elif goal.days_remaining == 1 %}
            Due tomorrow
            {% elif goal.days_remaining > 0 %}
            {{ goal.days_remaining }} days left
            {% endif %}
        </span>
        {% endif %}
        {% with milestone_count=goal.milestones.count %}
        {% if milestone_count > 0 %}
        <span class="goal-meta-item">
            <i class="bi bi-flag"></i>
            {{ milestone_count }} milestones
        </span>
        {% endif %}
        {% endwith %}
        {% if goal.journal_entries.count > 0 %}
        <span class="goal-meta-item">
            <i class="bi bi-journal"></i>
            {{ goal.journal_entries.count }} entries
        </span>
        {% endif %}
    </div>
</div>
